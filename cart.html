<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart</title>
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>

    <div class="container mt-5">
        <h2 class="text-center">Your Shopping Cart</h2>
        <table class="table table-bordered mt-4">
            <thead class="table-dark">
                <tr>
                    <th>Item</th>
                    <th>Quantity</th>
                    <th>Price</th>
                    <th>Total</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="cart-items">
                <tr>
                    <td colspan="5" class="text-center">Your cart is empty</td>
                </tr>
            </tbody>
        </table>

        <!-- Payment and Checkout Section -->
        <div class="mt-4">
            <h4>Total: ₹<span id="cart-total">0</span></h4>
            <label for="payment-method" class="form-label">Select Payment Method:</label>
            <select class="form-select" id="payment-method">
                <option value="card">Credit/Debit Card</option>
                <option value="upi">UPI</option>
                <option value="cod">Cash on Delivery</option>
            </select>
            
            <div id="card-payment" class="mt-3" style="display: none;">
                <h5>Enter Card Details:</h5>
                <input type="text" class="form-control mb-2" id="card-number" placeholder="Card Number" required>
                <input type="text" class="form-control mb-2" id="card-holder" placeholder="Card Holder Name" required>
                
                <!-- Month picker for expiry date -->
                <input type="month" class="form-control mb-2" id="expiry-date" required>

                <input type="password" class="form-control mb-2" id="cvv" placeholder="CVV" required>
            </div>
            
            <div id="upi-payment" class="mt-3" style="display: none;">
                <p>Scan the QR Code to complete the payment:</p>
                <img src="img/QR.jpg" alt="UPI QR Code" width="200">
            </div>
            
            <button class="btn btn-success mt-3" id="checkout-btn" disabled>Proceed to Payment</button>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            let cart = JSON.parse(localStorage.getItem("cart")) || [];
            const cartTotalElement = document.getElementById("cart-total");
            const checkoutButton = document.getElementById("checkout-btn");
            const cartItemsContainer = document.getElementById("cart-items");
            const paymentMethodSelect = document.getElementById("payment-method");
            const upiPaymentSection = document.getElementById("upi-payment");
            const cardPaymentSection = document.getElementById("card-payment");
            const cardNumber = document.getElementById("card-number");
            const cardHolder = document.getElementById("card-holder");
            const expiryDate = document.getElementById("expiry-date");
            const cvv = document.getElementById("cvv");

            function updateCartDisplay() {
                cartItemsContainer.innerHTML = "";
                let totalAmount = 0;

                if (cart.length === 0) {
                    cartItemsContainer.innerHTML = '<tr><td colspan="5" class="text-center">Your cart is empty</td></tr>';
                    checkoutButton.disabled = true;
                    return;
                }

                cart.forEach((item, index) => {
                    totalAmount += item.price * item.quantity;
                    let row = `
                        <tr>
                            <td>${item.name}</td>
                            <td>${item.quantity}</td>
                            <td>₹${item.price}</td>
                            <td>₹${item.price * item.quantity}</td>
                            <td><button class="btn btn-danger btn-sm remove-btn" data-index="${index}">Remove</button></td>
                        </tr>
                    `;
                    cartItemsContainer.innerHTML += row;
                });
                cartTotalElement.textContent = totalAmount;
                checkoutButton.disabled = false;

                // Attach remove event listener to each remove button
                document.querySelectorAll(".remove-btn").forEach(button => {
                    button.addEventListener("click", function () {
                        let index = this.getAttribute("data-index");
                        removeItem(index);
                    });
                });
            }

            function removeItem(index) {
                cart.splice(index, 1);
                localStorage.setItem("cart", JSON.stringify(cart));
                updateCartDisplay();
            }

            paymentMethodSelect.addEventListener("change", function () {
                if (this.value === "upi") {
                    upiPaymentSection.style.display = "block";
                    cardPaymentSection.style.display = "none";
                } else if (this.value === "card") {
                    upiPaymentSection.style.display = "none";
                    cardPaymentSection.style.display = "block";
                } else {
                    upiPaymentSection.style.display = "none";
                    cardPaymentSection.style.display = "none";
                }
            });

            checkoutButton.addEventListener("click", function () {
                let paymentMethod = paymentMethodSelect.value;
                
                if (paymentMethod === "card") {
                    if (!cardNumber.value || !cardHolder.value || !expiryDate.value || !cvv.value) {
                        alert("Please enter all card details.");
                        return;
                    }

                    // Format expiry date as MM/YY
                    let formattedExpiry = expiryDate.value.split("-");
                    let expiryFormatted = formattedExpiry[1] + "/" + formattedExpiry[0].slice(-2);
                    console.log("Expiry Date:", expiryFormatted);
                }

                let message = "Your order has been placed successfully!\n\n";
                message += "Payment Method: " + (paymentMethod === "cod" ? "Cash on Delivery" : paymentMethod.toUpperCase());
                alert(message);
                localStorage.removeItem("cart");
                cart = [];
                updateCartDisplay();
                setTimeout(() => location.reload(), 1000); // Auto refresh after checkout
            });

            updateCartDisplay();
        });
    </script>
</body>
</html>
